{% load render_table from django_tables2 %}
{% load filter_tags %}

{% if filter %}
{% has_active_filters filter as filters_active %}
<div class="collapse {% if filters_active %}show{% endif %} mb-3" id="filterCollapse">
  <div class="card">
    <div class="card-body">
      <form method="get" class="row g-3" hx-get="{{ request.path }}" hx-target="#list-content" hx-push-url="true" hx-trigger="change delay:300ms, submit">
        {% for field in filter.form %}
          {% if field.name != 'csrfmiddlewaretoken' %}
          <div class="col-md-4">
            <label for="{{ field.id_for_label }}" class="form-label">{{ field.label }}</label>
            {{ field }}
            {% if field.errors %}
              <div class="invalid-feedback d-block">
                {{ field.errors }}
              </div>
            {% endif %}
          </div>
          {% endif %}
        {% endfor %}
        <div class="col-12">
          <button type="submit" class="btn btn-primary">
            <i class="bi bi-search"></i> Filtrar
          </button>
          <a href="{{ request.path }}" class="btn btn-secondary" hx-get="{{ request.path }}" hx-target="#list-content" hx-push-url="true">
            <i class="bi bi-x-circle"></i> Limpar
          </a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}

<div class="card">
  <div class="card-body p-0">
    {% render_table table %}
  </div>
</div>
