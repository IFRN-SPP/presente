{% load static django_htmx %}
<!doctype html>
<html lang="pt-br">
  <!--begin::Head-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>presente! | {% block title %}{% endblock %}</title>

    <!--begin::Favicons-->
    <link rel="icon" type="image/x-icon" href="{% static 'img/favicon.ico' %}" />
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon-16x16.png' %}" />
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon-32x32.png' %}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/apple-touch-icon.png' %}" />
    <!--end::Favicons-->

    <!--begin::Meta Tags-->
    <meta name="description" content="Registre sua presença em atividades do IFRN!" />
    <meta name="keywords" content="presença, IFRN, SPP, registro, atividades, QR Code" />
    <meta name="author" content="IFRN/SPP" />
    <meta name="theme-color" content="#667eea" />

    <!--begin::Open Graph-->
    <meta property="og:title" content="presente!" />
    <meta property="og:description" content="Registre sua presença em atividades do IFRN!" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="{% static 'img/presente-icon.svg' %}" />

    <!--begin::Twitter Card-->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="presente!" />
    <meta name="twitter:description" content="Registre sua presença em atividades do IFRN!" />
    <meta name="twitter:image" content="{% static 'img/presente-icon.svg' %}" />
    <!--end::Meta Tags-->
    <!--begin::Fonts-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
      integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q="
      crossorigin="anonymous"
    />
    <!--end::Fonts-->
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/styles/overlayscrollbars.min.css"
      integrity="sha256-tZHrRjVqNSRyWg2wbppGnT833E/Ys0DHWGwT04GiqQg="
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(OverlayScrollbars)-->
    <!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI="
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(Bootstrap Icons)-->
    <!--begin::Required Plugin(AdminLTE)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/admin-lte@4.0.0-beta3/dist/css/adminlte.min.css"
      crossorigin="anonymous"
    />
    <!--begin::Custom Styles-->
    <link rel="stylesheet" href="{% static 'css/tables.css' %}" />
    <link rel="stylesheet" href="{% static 'css/presente.css' %}" />
    <!--end::Custom Styles-->
    <!--begin::Tom Select-->
    <link href="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/css/tom-select.bootstrap5.min.css" rel="stylesheet">
    <!--end::Tom Select-->
    {% htmx_script %}
    {% block extra_head %} {% endblock %}
    <!--end::Required Plugin(AdminLTE)-->
  </head>
  <!--end::Head-->
  <!--begin::Body-->
  <body class="{% block body_class %}layout-fixed sidebar-expand-lg bg-body-tertiary{% endblock %}">
    <!--begin::App Wrapper-->
    {% block app_wrapper %}
      
    {% endblock %}
    <!--end::App Wrapper-->
    <!--begin::Script-->
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <script
      src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js"
      integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ="
      crossorigin="anonymous"
    ></script>
    <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
    <script 
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
    <script
      src="https://cdn.jsdelivr.net/npm/admin-lte@4.0.0-beta3/dist/js/adminlte.min.js"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(AdminLTE)-->
    <!--begin::Tom Select-->
    <script src="https://cdn.jsdelivr.net/npm/tom-select@2.3.1/dist/js/tom-select.complete.min.js"></script>
    <!--end::Tom Select-->
    <!--begin::OverlayScrollbars Configure-->
    <script>
      const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
      const Default = {
        scrollbarTheme: 'os-theme-light',
        scrollbarAutoHide: 'leave',
        scrollbarClickScroll: true,
      };
      document.addEventListener('DOMContentLoaded', function () {
        const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
        if (sidebarWrapper && typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== 'undefined') {
          OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
            scrollbars: {
              theme: Default.scrollbarTheme,
              autoHide: Default.scrollbarAutoHide,
              clickScroll: Default.scrollbarClickScroll,
            },
          });
        }

        // Initialize Tom Select for multi-select fields (needs to run after DOM is ready)
        setTimeout(function() {
          // Multi-select for users
          document.querySelectorAll('[data-tom-select="users"]').forEach(function(el) {
            if (!el.tomselect) {
              new TomSelect(el, {
                plugins: ['remove_button'],
                persist: false,
                create: false,
                maxItems: null,
                preload: false,
                loadThrottle: 300,
                onInitialize: function() {
                  // Hide dropdown initially
                  this.clearOptions();
                },
                load: function(query, callback) {
                  // Only load if at least 2 characters typed
                  if (query.length < 2) {
                    return callback();
                  }
                  // Reload all options and filter
                  const allOptions = Array.from(el.querySelectorAll('option')).map(opt => ({
                    value: opt.value,
                    text: opt.text
                  })).filter(opt => opt.value && opt.text.toLowerCase().includes(query.toLowerCase()));
                  callback(allOptions);
                },
                render: {
                  option: function(data, escape) {
                    return '<div>' + escape(data.text) + '</div>';
                  },
                  item: function(data, escape) {
                    return '<div>' + escape(data.text) + '</div>';
                  }
                }
              });
            }
          });

          // Multi-select for tags with create
          document.querySelectorAll('[data-tom-select="tags"]').forEach(function(el) {
            if (!el.tomselect) {
              new TomSelect(el, {
                plugins: ['remove_button'],
                persist: false,
                create: true,
                maxItems: null,
                preload: false,
                loadThrottle: 300,
                onInitialize: function() {
                  // Store all options and clear initially
                  this.allOptions = Array.from(el.querySelectorAll('option')).map(opt => ({
                    value: opt.value,
                    text: opt.text
                  })).filter(opt => opt.value);
                  this.clearOptions();
                },
                load: function(query, callback) {
                  // Only load if at least 2 characters typed
                  if (query.length < 2) {
                    return callback();
                  }
                  // Filter stored options
                  const filtered = this.allOptions.filter(opt =>
                    opt.text.toLowerCase().includes(query.toLowerCase())
                  );
                  callback(filtered);
                },
                render: {
                  option_create: function(data, escape) {
                    return '<div class="create">Adicionar <strong>' + escape(data.input) + '</strong>&hellip;</div>';
                  },
                  no_results: function(data, escape) {
                    if (data.input.length < 2) {
                      return '<div class="no-results">Digite ao menos 2 caracteres...</div>';
                    }
                    return '<div class="no-results">Nenhum resultado encontrado.</div>';
                  }
                }
              });
            }
          });

          // Simple select dropdowns (single select)
          document.querySelectorAll('[data-tom-select="simple"]').forEach(function(el) {
            if (!el.tomselect) {
              new TomSelect(el, {
                persist: false,
                create: false,
                allowEmptyOption: true,
                placeholder: el.getAttribute('placeholder') || 'Selecione...',
              });
            }
          });
        }, 100);
      });
    </script>
    {% block extra_body %}
      
    {% endblock %}
    <!--end::OverlayScrollbars Configure-->
    <!--end::Script-->
  </body>
  <!--end::Body-->
</html>
