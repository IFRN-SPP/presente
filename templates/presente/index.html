{% extends "presente/private_base.html" %}

{% block app_content %}
<div class="container-fluid">
  <div class="row">
    {% if perms.presente.view_activity %}
    <div class="col-lg-3 col-6">
      <div class="card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted text-uppercase mb-2">Atividades</h6>
              <h2 class="mb-0">{{ activities }}</h2>
            </div>
            <div class="text-success" style="font-size: 3rem;">
              <i class="bi bi-list-check"></i>
            </div>
          </div>
        </div>
        <div class="card-footer bg-light">
          <a href="{% url 'presente:activity_list' %}" class="small text-decoration-none">
            Ver todas <i class="bi bi-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>
    {% endif %}

    <div class="col-lg-3 col-6">
      <div class="card h-100">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="text-muted text-uppercase mb-2">Minhas Presenças</h6>
              <h2 class="mb-0">{{ my_attendances_count }}</h2>
            </div>
            <div class="text-info" style="font-size: 3rem;">
              <i class="bi bi-check2-circle"></i>
            </div>
          </div>
        </div>
        <div class="card-footer bg-light">
          <a href="{% url 'presente:my_attendances' %}" class="small text-decoration-none">
            Ver todas <i class="bi bi-arrow-right"></i>
          </a>
        </div>
      </div>
    </div>
  </div>

  {% if recent_attendances %}
  <div class="row mt-4">
    <div class="col-12">
      <div class="card card-primary">
        <div class="card-header">
          <div class="card-title">
            <i class="bi bi-clock-history"></i> Presenças Recentes
          </div>
          <a href="{% url 'presente:my_attendances' %}" class="btn btn-sm btn-light float-end">
            Ver todas
          </a>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
              <thead>
                <tr>
                  <th>Atividade</th>
                  <th>Tags</th>
                  <th>Data da Atividade</th>
                  <th>Presença Registrada</th>
                </tr>
              </thead>
              <tbody>
                {% for attendance in recent_attendances %}
                <tr>
                  <td>{{ attendance.activity.title }}</td>
                  <td>
                    {% if attendance.activity.tags.all %}
                      {% for tag in attendance.activity.tags.all %}
                        <span class="badge bg-secondary me-1">{{ tag.name }}</span>
                      {% endfor %}
                    {% else %}
                      <span class="text-muted small">Sem tags</span>
                    {% endif %}
                  </td>
                  <td>{{ attendance.activity.start_time|date:"d/m/Y H:i" }}</td>
                  <td>
                    <i class="bi bi-check-circle-fill text-success"></i>
                    {{ attendance.checked_in_at|date:"d/m/Y H:i:s" }}
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  {% if not recent_attendances %}
  <div class="row mt-4">
    <div class="col-12">
      <div class="card card-info card-outline">
        <div class="card-header">
          <div class="card-title">
            <i class="bi bi-info-circle"></i> Você está no <strong>presente!</strong>
          </div>
        </div>
        <div class="card-body">
          <h6>Como funciona:</h6>
          <ul class="mb-0">
            {% if perms.presente.activity_create %}
              <li><strong>Atividades:</strong> Crie atividades definindo data, horário e tempo de renovação do QR Code.</li>
              <li><strong>Tags:</strong> Organize suas atividades com tags para facilitar buscas e relatórios.</li>
              <li><strong>QR Code:</strong> O <strong>presente!</strong> gera códigos dinâmicos que garantem segurança e evitam compartilhamentos indevidos.</li>
              <li><strong>Presenças:</strong> Acompanhe quem registrou presença e consulte o histórico rapidamente.</li>
            {% else %}
              <li><strong>Atividades:</strong> Registre presença escaneando o QR Code exibido na sala ou no evento.</li>
              <li><strong>QR Code:</strong> O código muda automaticamente para garantir que apenas quem está presente possa usá-lo.</li>
              <li><strong>Tags:</strong> Use tags para filtrar e visualizar suas presenças com facilidade.</li>
              <li><strong>Presenças:</strong> Consulte seu histórico de forma simples no <strong>presente!</strong>.</li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
